# molecad

API для извлечения информации из баз данных Pubchem и дальнейшего взаимодействия с этими данными.

## Содержание

* [Документация на Confluence](#документация-на-confluence)
* [Настройка виртуального окружения](#настройка-виртуального-окружения)
* [Настройка переменных окружения](#настройка-переменных-окружения)
* [Как развернуть MongoDB локально на macOS](#как-развернуть-mongodb-локально-на-macos)
* [Скрипт для скачивания молекул с Pubchem и их загрузки в MongoDB](#cкрипт-для-скачивания-молекул-с-pubchem-и-их-загрузки-в-mongodb)  
* [Использование mongo-rdkit для подструктурного поиска по базе](#использование-mongo-rdkit-для-подструктурного-поиска-по-базе)
* [Схема базы данных](#схема-базы-данных)
* [Документация ручек API](#документация-ручек-api)
* [Структура проекта](#структура-проекта)


## Документация на Confluence

* [Как развернуть MongoDB локально на macOS](https://confluence.biocad.ru/x/3BhQCw)
* [Что можно скачать из баз данных PubChem](https://confluence.biocad.ru/x/DwpQCw)
* [Как использовать molecad для скачивания данных из Pubchem](https://confluence.biocad.ru/x/_ixQCw)
* [Описание ручек api](https://confluence.biocad.ru/x/jCxQCw)


## Настройка виртуального окружения

> Перед тем как приступить к настройке виртуального окружения, убедитесь, что на вашем компьютере 
> установлены [pyenv](https://github.com/pyenv/pyenv-installer) и [poetry](https://python-poetry.org/docs/), 
> причем их пути должны быть добавлены в `PATH`.

Склонируйте [репозиторий](https://github.com/vvrubel/molecad) и запустите shell из директории, 
содержащей файл `pyproject.toml`.

В проекте используется Python версии 3.7.10, который вы можете установить, используя `pyenv`:

```console
pyenv install 3.7.10
pyenv local 3.7.10
```

Создать виртуальное окружение и установить все зависимости проекта можно с помощью `poetry`:

```console
poetry install
```

Вуаля! Все зависимости проекта установлены и никакой конды, вам не потребовалось.  
Подробнее о реализации пути через `conda` можно почитать [тут](https://confluence.biocad.ru/x/vi1QCw).


## Настройка переменных окружения

После настройки виртуальной среды, необходимо задать переменные окружения – это параметры для 
настройки api, подключения к mongodb, запуска скрипта, выполняющего запросы к базам данных Pubchem.  
Удобнее всего установить их один раз, создав файл `.env` из шаблона `.env.sample`. 

В корневой директории найдите файл `.env.sample`, скопируйте его, заполните недостающие поля и 
переименуйте в `.env`.

Переменные окружения в файле `.env` могут быть двух типов: имеющие значение по умолчанию и нет. 
Переменные не имеющие значений по умолчанию обязательны к первоначальной настройке.

| Переменная | Описание | Значение по умолчанию | 
|---|---|---|
|ENV|---|---|
|SERVICE_URL|URL-адрес запущенного приложения. Вы можете запустить приложение и без него, но тогда вы не сможете поймать никаких веб-перехватчиков. Поэтому даже для локальной разработки рекомендуется устанавливать API из сети BIOCAD (например, http://10.249.233.40:8888/). Не забудьте указать порт (т.е. 8888) и протокол (http или https).|"http://localhost:8888"|
|MONGO_HOST|Хост базы данных MongoDB, если значение не определено, то будет использоваться хост локальной базы|"127.0.0.1"|
|MONGO_PORT|Порт базы данных MongoDB, если значение не определено, то будет использоваться порт локальной базы|27017|
|MONGO_USER|---|---|
|MONGO_PASSWORD|---|None|
|MONGO_DB_NAME|---|"molecad"|
|MONGO_DB_COLLECTION|---|"molecules"|
|MONGO_AUTH_SOURCE|---|"admin"|
|PROJ_DIR|Путь до корневой директории проекта|---|
|OUT_DIR|Путь до директории, куда будет сохранен файл-результат запроса к Pubchem|---|
|FILES_DIR|Путь до директории, в которую будут сохранены файлы-чанки со свойствами молекул. Файлы, содержащиеся в этой директории, будут выгружены в локальную базу данных MongoDB.|---|
|JSON|Путь до сохраненного большого файла JSON, который в дальнейшем будет разрезан на чанки|---|
